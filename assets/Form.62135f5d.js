import{c as I,r as C,p as $,ag as B,e as E,f as O,m as A,h as w,g as D,j as U,ah as j,s as Q,ai as z,aj as M,_ as K,F as N,U as G,ak as J,G as L,I as T,J as H,K as i,ac as W,L as s,al as V,a8 as S,i as q,N as R,am as X}from"./index.e8e10fc1.js";import{u as Y}from"./useDatabase.e22061e5.js";import{u as Z}from"./contaStore.935d8630.js";var ee=I({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(a,{slots:o,emit:v}){const h=U(),d=C(null);let c=0;const e=[];function l(t){const r=typeof t=="boolean"?t:a.noErrorFocus!==!0,g=++c,P=(n,u)=>{v("validation"+(n===!0?"Success":"Error"),u)},F=n=>{const u=n.validate();return typeof u.then=="function"?u.then(m=>({valid:m,comp:n}),m=>({valid:!1,comp:n,err:m})):Promise.resolve({valid:u,comp:n})};return(a.greedy===!0?Promise.all(e.map(F)).then(n=>n.filter(u=>u.valid!==!0)):e.reduce((n,u)=>n.then(()=>F(u).then(m=>{if(m.valid===!1)return Promise.reject(m)})),Promise.resolve()).catch(n=>[n])).then(n=>{if(n===void 0||n.length===0)return g===c&&P(!0),!0;if(g===c){const{comp:u,err:m}=n[0];if(m!==void 0&&console.error(m),P(!1,u),r===!0){const _=n.find(({comp:k})=>typeof k.focus=="function"&&j(k.$)===!1);_!==void 0&&_.comp.focus()}}return!1})}function y(){c++,e.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function f(t){t!==void 0&&Q(t);const r=c+1;l().then(g=>{r===c&&g===!0&&(a.onSubmit!==void 0?v("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function x(t){t!==void 0&&Q(t),v("reset"),z(()=>{y(),a.autofocus===!0&&a.noResetFocus!==!0&&p()})}function p(){M(()=>{if(d.value===null)return;const t=d.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||d.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||d.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(d.value.querySelectorAll("[tabindex]"),r=>r.tabIndex>-1);t!=null&&t.focus({preventScroll:!0})})}$(B,{bindComponent(t){e.push(t)},unbindComponent(t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}});let b=!1;return E(()=>{b=!0}),O(()=>{b===!0&&a.autofocus===!0&&p()}),A(()=>{a.autofocus===!0&&p()}),Object.assign(h.proxy,{validate:l,resetValidation:y,submit:f,reset:x,focus:p,getValidationComponents:()=>e}),()=>w("form",{class:"q-form",ref:d,onSubmit:f,onReset:x},D(o.default))}});const te=N({name:"PageIndex",setup(){const a=G(),o=J(),v=L(),{buscar:h,adicionar:d,atualizar:c}=Y(),{addConta:e}=Z(),l=C({name:"",category:"",amount:0,quantity:0}),y=C(!1),f="expense",x=()=>y.value?b():p(),p=()=>{d(f,l.value).then(r=>{a.notify({message:"Produto salvo com sucesso!",color:"positive",icon:"check"}),e(l.value),document.querySelector("#cancel").click()}).catch(r=>{a.notify({message:r,color:"negative",icon:"close"})})},b=()=>{const{id:r}=o.params;c(f,r,l.value).then(()=>{a.notify({message:"Produto atualizada com sucesso!",color:"positive",icon:"check"}),v.push({name:"lista"})}).catch(g=>{a.notify({message:g,color:"negative",icon:"close"})})},t=()=>{l.value={name:"",category:o.params.category,amount:0,quantity:0}};return A(async()=>{l.value.category=o.params.category||"",o.params&&o.params.id&&(y.value=!0,l.value=await h(f,o.params.id))}),{expense:l,collection:f,editar:y,tipoAcao:x,salvarProduto:p,atualizarProduto:b,reset:t}}});function ae(a,o,v,h,d,c){return T(),H(W,{padding:""},{default:i(()=>[s(ee,{onSubmit:X(a.tipoAcao,["prevent"]),onReset:a.reset},{default:i(()=>[s(V,{outlined:"",label:"Descri\xE7\xE3o",modelValue:a.expense.name,"onUpdate:modelValue":o[0]||(o[0]=e=>a.expense.name=e),modelModifiers:{trim:!0},rules:[e=>e&&e.length>0||"Descri\xE7\xE3o Obrigat\xF3ria"]},{append:i(()=>[s(S,null,{default:i(()=>[s(q,{name:"insert_comment"})]),_:1})]),_:1},8,["modelValue","rules"]),s(V,{outlined:"",label:"Categoria",modelValue:a.expense.category,"onUpdate:modelValue":o[1]||(o[1]=e=>a.expense.category=e),modelModifiers:{trim:!0},rules:[e=>e&&e.length>0||"Categoria Obrigat\xF3ria"],disable:""},{append:i(()=>[s(S,null,{default:i(()=>[s(q,{name:"sell"})]),_:1})]),_:1},8,["modelValue","rules"]),s(V,{outlined:"",placeholder:"R$",type:"tel",mask:"#.##","fill-mask":"0","reverse-fill-mask":"",modelValue:a.expense.amount,"onUpdate:modelValue":o[2]||(o[2]=e=>a.expense.amount=e),label:"R$",class:"q-mt-md",hint:"O valor do produto pode ser cadastrado depois"},{append:i(()=>[s(S,null,{default:i(()=>[s(q,{name:"monetization_on"})]),_:1})]),_:1},8,["modelValue"]),s(V,{outlined:"",label:"Quantidade",type:"tel",modelValue:a.expense.quantity,"onUpdate:modelValue":o[3]||(o[3]=e=>a.expense.quantity=e),rules:[e=>e&&e.length>0||"Quantidade Obrigat\xF3ria"],class:"q-mt-md"},{append:i(()=>[s(S,null,{default:i(()=>[s(q,{name:"add_circle"})]),_:1})]),_:1},8,["modelValue","rules"]),s(R,{unelevated:"",type:"submit",color:"primary",label:"Salvar",icon:"save",class:"full-width q-mt-md"}),s(R,{type:"reset",id:"cancel",icon:"delete",class:"full-width q-mt-md",style:{display:"none"}})]),_:1},8,["onSubmit","onReset"])]),_:1})}var ue=K(te,[["render",ae]]);export{ue as default};
